要件定義書（AI Meeting Autopilot v1） 0. 目的・背景

目的：Google Docs 議事録から、人別振り返り・ToDo、事前ヒアリング、合体アジェンダ投稿までを完全自動化し、進行役の準備負担・催促コストを削減、会議時間の短縮と意思決定の高速化を実現する。

効果指標（KPI）

会議準備時間：平均 -50%

催促メンション回数：-70%

会議時間：-20%

タスク見落とし率：-80%

1. スコープ

対象会議：MEETING_KEY（例：AI 基盤 MTG）で識別される定例

対象データ：対象フォルダ配下の Google Docs、Google Sheets（集計台帳）、Slack チャンネル（配信用）

運用方式：GitHub Actions の定時実行＋ Slack/Google API の Pull/Push

非スコープ（v1 ではやらない）

Notion/Confluence 連携、カレンダー招待の自動作成、Zoom/Meet 自動録音/議事要約の生成

2. ステークホルダー

プロダクトオーナー：あなた

進行役：会議ファシリテータ（主に閲覧）

参加者：Slack でヒアリング回答

開発/運用：あなた or 開発担当者

3. 用語

meeting_key：会議の論理名

parent_ts：Slack 親投稿の ts（スレのアンカー）

合体アジェンダ：前回未決 × 最新報告 × ブロッカーの統合本文

4. 前提・制約

認証：OAuth（本人実行）。CLIENT_ID/SECRET/REFRESH_TOKEN を GitHub Secrets に格納。

API：Drive/Docs/Sheets/（任意で Calendar）を Cloud Console で有効化済み。

権限：対象 Docs/フォルダは本人が閲覧可。Slack App は対象チャンネルへ投稿権限あり。

時刻：JST 運用、cron は UTC（+9h 補正）。

費用：GCP 追加課金なし想定（API 無料枠内）。

5. 機能要件（FR）
   FR-1 Drive→Docs 自動特定

入力：MEETING_KEY、対象フォルダ ID、基準日（当日）

処理：Drive API でフォルダ内の Docs を更新日時降順に検索 → タイトル/パスに MEETING_KEY ＋日付パターン一致の最新 1 件を特定（規約は設定可能）

出力：doc_id / title / date を取得

FR-2 Docs 本文抽出 →Sheets 保存

処理：Docs API で段落要素をテキスト化（装飾除去、最小限の改行）

保存：meetings シートに upsert

meeting_id(doc_id) / meeting_key / date / title / doc_id / channel_id / parent_ts(空)

任意で元本文アーカイブ（別タブ or Drive）

FR-3 参加者名寄せ（任意）

処理：Calendar API で該当イベントの attendees.email[] を取得（fallback: 議事録内の出席者行パース）

名寄せ：mappings（email↔slack_id）で解決。未登録は users.lookupByEmail で補完し mappings 更新。

FR-4 アクション抽出（Gemini）

入力：議事録本文

出力：厳密 JSON 配列

task: str, assignee_email: str, due: "YYYY-MM-DD" | null, links: [str]

正規化：assignee_email→slack_id 解決、dedupe_key = {date}:{assignee_email}:{hash(task)}

保存：items に upsert（status=pending 初期化）

FR-5 Slack 親投稿（人別振り返り＋ NextAction）

入力：items を担当者単位に集約

本文：人別の要点（今週の NextAction、due 付き）

出力：投稿 ts を meetings.parent_ts に保存

FR-6 ヒアリング投下（2 日前）

テンプレ：

前回 ToDo の状況 / 2. 今回の報告（1–3）/ 3. ブロッカー/依頼 / 4. リンク

投稿：親スレに**人別@**で個別返信

保存：hearing_prompts(meeting_id, channel_id, parent_ts, assignee_slack_id, prompt_ts, due_to_reply)

FR-7 返信収集・パース（毎朝）

処理：conversations.replies で全スレ取得 → 本人の直近回答を抽出

パース：番号付き/箇条書き/コロン区切りにロバスト、4 項目へ整形

保存：hearing_responses upsert

催促：未返信者へ軽いメンション or DM（1 日 1 回上限）

FR-8 合体アジェンダ生成（前日）

素材：

未決タスク（items status≠done）を期限/担当でソート

hearing_responses から人別ハイライト（1–2 行）

ブロッカー/依頼一覧

Top3 選定：期限の近さ＋ブロッカー重み＋件数のスコアリング

保存：agendas.body_md（Markdown）

FR-9 最終アジェンダ投稿（前日）

投稿先：親 or スレ先頭（運用選択）

保存：agendas.posted_ts

FR-10 冪等性

要件：ジョブが再実行されても重複投稿/重複登録が発生しないこと

items.dedupe_key、meetings.parent_ts、hearing_responses(meeting_id+user+reply_ts)で制御

FR-11 ログと監視

Actions ログ：主要イベント（Docs 特定件数、抽出件数、投稿 TS）を print

アラート：致命エラー時は Slack に ⚠️ 投稿（専用チャンネル/スレ）

6. データ要件（Sheets タブ定義）
   mappings

meeting_key / slack_channel_id

email / slack_user_id / display_name

meetings

meeting_id / meeting_key / date(YYYY-MM-DD) / title / doc_id / participant_emails(csv) / channel_id / parent_ts

items

date / meeting_id / task / assignee_email / assignee_slack_id / due / links(csv) / status(pending|done|dropped) / dedupe_key

hearing_prompts

meeting_id / channel_id / parent_ts / assignee_slack_id / prompt_ts / due_to_reply / status(sent|collected|overdue)

hearing_responses

meeting_id / assignee_slack_id / reply_ts

todo_status / reports / blockers / links / raw_text

agendas

meeting_id / channel_id / thread_ts / body_md / posted_ts

7. スケジュール要件（GitHub Actions）
   フェーズ JST UTC(cron) ジョブ
   会議当日取り込み 16:00 07:00 docs_ingest → action_extract → post_retrospective
   2 日前ヒアリング 10:00 01:00 post_hearing
   毎朝収集 09:00 00:00 collect_replies（＋やさしい催促）
   前日アジェンダ 16:00 07:00 build_agenda → post_agenda
8. 非機能要件（NFR）

信頼性：API 失敗は指数バックオフで 3 回まで自動リトライ。

可用性：各ジョブは互いに独立（失敗しても翌日リカバー可）。

セキュリティ：Secrets でトークン管理。ログ出力に機密値を含めない。

性能：対象 1 会議・参加者 10 名規模で実行時間 < 60 秒/ジョブ。

保守性：モジュール分割（src/\*.py）、設定は環境変数に集約。

監査：Sheets に全ての投稿 TS/抽出結果を残す。

9. エラー処理・フォールバック

Docs 未検出：前日/前週を順に探索、見つからなければ Slack へ「未検出」通知。

メンション未解決：@表示名 のまま投稿し、mappings 更新リマインド。

ヒアリング未返信：期限超過で 1 回だけやさしい催促。

JSON 抽出失敗：Gemini 再試行 → 失敗時は「抽出失敗（要手動）」を Slack 通知。

10. 受け入れ基準（UAT）

当日ジョブで Docs 特定 →meetings 追加 →items 抽出 →Slack 親投稿 が自動で行われる

2 日前ジョブで 人別@のヒアリング がスレに並ぶ

毎朝ジョブで スレ回答が hearing_responses に格納 され、未返信者へ催促が 1 回送られる

前日ジョブで agendas.body_md が生成され、Slack へ最終アジェンダが投稿される

再実行しても重複が起きない（冪等）

11. テスト観点（代表）

正常系：1 週間分の運転テスト（各日ジョブ）、人別 2〜3 名で回答パターン差分

例外系：Docs 未発行、空本文、メール ↔Slack 未対応、Gemini 失敗、Slack rate limit

パース：番号付き/箇条書き/改行/コロン区切りの混在に対する 4 項目抽出精度

12. リスクと対策

Docs 命名揺れ：Drive 検索条件を MEETING_KEY + YYYY-MM 程度に緩和し本文から日付補正

参加者判定の揺れ：Calendar 併用＋ mappings キャッシュを運用更新

人依存（OAuth）：v1 は本人実行。将来的に SA 切替の移行手順を用意

13. 権限・Secrets（確定値）

GOOGLE_CLIENT_ID / GOOGLE_CLIENT_SECRET / GOOGLE_REFRESH_TOKEN

SLACK_BOT_TOKEN

DEFAULT_TIMEZONE=Asia/Tokyo

（任意）PRIMARY_SHEET_ID / DEFAULT_CHANNEL_ID / DRIVE_FOLDER_ID / MEETING_KEY

14. リポジトリ構成（合意）
    .github/workflows/ # 4 本の定時ワークフロー
    src/
    auth.py # Refresh→Access
    google_clients.py # docs/sheets/drive (calendar 任意)
    sheets_repo.py # CRUD
    slack_client.py # 投稿/返信取得/lookup
    docs_ingest.py
    action_extract.py # Gemini 抽出＋正規化
    post_retrospective.py
    post_hearing.py
    collect_replies.py
    build_agenda.py
    post_agenda.py
    requirements.txt
    README.md
